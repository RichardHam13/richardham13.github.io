

![unicode](https://24gadget.ru/uploads/posts/2017-04/thumbs/1491982748_penna-001.jpg)

# **"Unicode"**

Unicode можно сравнить с русско-английским словарем, и чисто по субъективному мнению, назвать его символьно-кодовым словарем (точнее всего будет сказать символьно-кодовой таблицей). Точно таким же образом, как русско-английский словарь сопоставляет русскому слову английское, Unicode сопоставляет определенному символу кодировку (кодовую позицию).
Для того, чтобы понять причину популярности Юникода (разработчики стандарта рекомендуют именно такое написание на русском), необходимо ознакомиться с несколькими историческими фактами, послужившими его возникновению.

### Как возник Юникод?
Одной из первых созданных кодировок была ASCII, разработанная и стандартизированная в США в 1963 году. Она включала распространенные символы латинского алфавита, цифры, знаки препинания и непечатные символы. Изначально она была разработана для кодирования символов, коды которых помещались в 7 бит (128 символов). Все было прекрасно, когда кодировкой пользовались англоязычные пользователи. Со временем распространение ASCII по миру привело к расширению кодировки до 8 бит (256 символов), при этом первые 128 позиций остались неизменными, а последующие 128 были отданы для свободного использования национальным алфавитам.

Данное расширение породило большое количество различных, несовместимых друг с другом кодовых страниц (таблиц соответствия символов кодовой позиции), ни только в масштабах мира, но и в масштабах отдельно взятой страны. Во многих странах, помимо широко используемых кодировок, различные компании использовали свободный позиции кодировки ASCII для реализации своих узконаправленных задач.

Несовместимость порождала некорректное отображение информации на различных устройствах. В каждой из кодировок одному и тому же символу могла соответствовать различная кодовая позиция. При создании сообщения на одном компьютере, и отправке его на другой, могла возникнуть ситуация возникновения у получателя так называемой «кракозябры», то есть некорректном отображении сообщения из-за того, что компьютер получателя не поддерживал кодировку отправителя. Но если пользователи говорили на одном языке, и передавали информацию между устройствами, поддерживающими кодовую страницу, никаких проблем не возникало.

Таким образом отсутствие унифицированной системы кодирования не давало пользователям из разных точек планеты обмениваться информацией. В данной обстановке, существование Всемирной паутины (Интернета) было невозможным.

Одной из альтернатив стала конвертация форматов кодирования, но в большинстве случаев, это предполагало частичную потерю информации, в следствии того, что отсутствующие символы заменялись на графически похожие. Для азиатских стран использование однобайтовой системы кодирования вообще не представлялось возможным, из-за неалфавитной системы письма (иероглифической письменности), которая, например, в Китае достигает 3000 символов.

Но в век информационных технологий, когда в большинстве случаев обмен информацией происходит в электронном виде, с использованием различных устройств и на разных языках, становится нецелесообразным и неудобным использование кодовых страниц. Стало необходимым унифицировать большое количество различных кодировок, и сведение всего многообразия используемых символов в один стандарт.

Это и послужило предпосылкой к созданию унифицированной системы кодировки символов. Таким стандартом стал Unicode, предложенный в 1991 году некоммерческой организацией «Консорциум Юникода».

Unicode разрабатывался как стандарт кодирования символов, включающий в себя знаки, почти всех письменных языком мира, диапазон которых постоянно расширяется. Под символами подразумеваются - буквы алфавитов различных языков мира, мертвых языков, выдуманных языков (таких как Клингонский), цифры, знаки препинания, символы псевдографики и даже Emoji. Стандарт обеспечивает корректное отображение символов независимо от платформы, программы и используемого языка, при условии, что все перечисленное использует данный стандарт, или хотя бы семи битную кодировку ASCII.

>**Важно!**
Стандарт Юникод поддерживает полную совместимость с кодировкой ASCII, благодаря чему информация на старых системах, использующих ASCII, будет отображаться корректно, при условии использования формата кодирования UTF-8 (работа данного формата будет рассмотрена ниже).

### Что из себя представляет Unicode

Так как Unicode является стандартом многобайтовой кодировки, он смог охватить огромное количество символов. Ресурс Юникода ограничен разработчиками стандарта до 1 112 064 кодовых позиций, в связи с максимальной вместительностью формата UTF-16. Часть пространства зарезервирована для частного использования. На сегодняшний день, из всего диапазона доступных кодовых позиций, занято около 130 000.

Для обозначения символов Unicode используется запись вида «U+xxxx», где «хххх» — кодовая позиция (шестнадцатеричные числа). Шестнадцатиричное представление кодовых позиций используется по причине компактности записи.

Юникод представляет собой ничто иное, как стандарт (таблицу) в котором каждому символу присвоена определенная кодовая позиция. И сами по себе эти кодовые позиции для устройства являются пустым звуком. Поэтому, для преобразования кодовых позиций в строки байтов, понятных устройствам, были созданы форматы кодирования.

Изначально Юникод использовал два формата кодирования:

* UCS-1, являющийся 8-битным форматом с фиксированной шириной и диапазоном используемых кодовых позиций 256;
* UCS-2, являющийся 16-битным форматом с фиксированной шириной и диапазоном используемых кодовых позиций 65536.
Термин фиксированная ширина означает, что для кодирования символа отводится строго выделенное количество бит.

Диапазон 65536 кодовых позиций стали называть основной многоязычной плоскостью (BMP), так как он включал в себя большинство часто используемых символов различных языков.

Из-за недостаточной вместительности данных форматов кодирования, в 1996 году, было принято решение расширить кодовую область, и предложено использовать несколько новых форматов кодирования UTF. Самыми часто используемыми стали:

* 8-битный формат с переменной шириной символа UTF-8, является самым распространенным в сети Интернет, благодаря его экономичности и прозрачной совместимости с символами ASCII.
* 16-битный формат с переменной шириной символа UTF-16, получил большее распространение в Windows, Java, и многих других продуктах, исключительно по историческим причинам, потому как компании, разрабатывающие эти продукты, приняли стандарт Unicode до 1996 года, когда формат кодировки был 16-битным с фиксированной шириной.

Также, по историческим причинам, основанные на Unix операционные системы могут спокойно работать с UTF-8, но не поддерживать работу с UTF-16, по причине использования строк с нулевым символом в Си.

Одним из плюсов использования форматов кодирования UTF, стала возможность осуществлять конвертацию между ними без потери информации.

Оба формата используют диапазон четырех байт для кодирования данных, но ключевым различием форматов является то, что минимальный размер кодовой позиции в UTF-8 это один байт (один октет), а в UTF-16 это два байта (два октета). Благодаря этому свойству, размер файлов, использующих формат UTF-8, в большинстве случаев будет в два раза меньше.

Единицу в 8 бит (1 байт) принято называть октетом, поэтому данные значения будут в дальнейшем употребляться наравне.

### Ключевые различия кодировок

Как говорилось выше, ключевым различием форматов кодирования является то, сколько октетов будет использоваться для кодирования каждого символа, но еще одним существенным различием будет формат записи этих байтов.

Алгоритм работы кодировок состоит из нескольких этапов, первым из которых, для обоих форматов, является определение количества октетов необходимых для кодирования символа, согласно кодовой позиции, присвоенной в Юникод.

Следующим шагом UTF-8 заполняет старшие биты используемых октетов по шаблону:

Количество октетов	| Значащих бит |	Шаблон
--- | --- | --- 
1 |	7 | 0ххххххх
2 |	11 | 110ххххх 10хххххх
3 |	16 | 1110хххх 10хххххх 10хххххх
4 |	21 | 11110ххх 10хххххх 10хххххх 10хххххх

Шаблоны 0, 110, 1110, 11110 обозначают количество байт, задействованных в кодировании символа. Шаблоны 10 используются в последующих октетах, для обозначения продолжения кодовой строки символа.

Кодовые позиции символов, при использовании одного октета, полностью идентичны кодировке 7 битной ASCII, благодаря шаблону ноль в старшем бите. Также использование единицы в старших битах каждого байта, начиная с ширины символа в 2 октета, способствует отсутствию конфликтов при повреждении файла, сбоях в передаче или некорректном чтении.

Свободные биты октетов (значащие биты) заполняются номером кодовой позиции, в соответствии с Юникод.

При сбоях передачи или некорректном чтении данная структура записи позволяет достичь минимальных потерь информации.

В UTF-16 кодирование происходит по другому принципу.

UTF-16 не использует никаких шаблонов, а незадействованные старшие биты заполняет нулями. Так как в UTF-16 не используются шаблоны в старших битах, диапазон основной многоязычной плоскости вмещается в 2 октета. Символы, выходящие за пределы основной многоязычной плоскости, кодируются с помощью суррогатных пар, и занимают максимальные для формата 4 октета. Такая структура кодирования, при сбоях, повреждениях файла, или некорректном чтении, может привести к полной потере информации. UTF-16 также критичен к последовательности записи байт, её необходимо задавать принудительно, с помощью меток порядка байтов U+FEFF (big-endian, прямой порядок), U+FFFE (little-endian, обратный порядок), или использовать специальные разновидности формата UTF-16, такие как UTF-16LE и UTF-16BE, где метка порядка байтов не нужна.

### Преимущества и недостатки кодировок

Исходя из всего вышесказанного, можно выделить основные преимущества и недостатки использования того или иного формата кодирования.  

##### Плюсы UTF-8

* Основным преимуществом UTF-8 является то, что он обратно совместим с символами ASCII, таким образом, при открытии файла UTF-8 в текстовом редакторе ASCII, файл будет отображаться правильно (при условии, что он не будет содержать неанглийских символов). Это является главным преимуществом при работе с исходным кодом, который обычно состоит из английских символов. 
* Минимальные потери или их отсутствие при повреждении файла, сбоях в передаче, или некорректном чтении.
* Меньший размер файлов, при использовании некоторых письменностей.
* Минимальный размер символа 1 байт.

##### Минусы UTF-8

* Использование трёх октетов для кодирования многих символов азиатской письменности, в то время как UTF-16 может обойтись двумя октетами.

##### Плюсы UTF-16

Хотя UTF-16 не имеет явных преимуществ перед UTF-8, есть несколько областей где его использование может быть целесообразным.
* UTF-16 использует меньшее количество байт в некоторых языках входящих в основную многоязычную плоскость. Актуально для многих не западных языков в основном азиатских.
* Совместимость с более старой кодировкой UCS-2, которую в 1991 году приняли многие компании такие как Windows, Java и другие.

##### Минусы UTF-16

* Несовместимость с символами ASCII, из-за минимальной длины символа в 2 байта. Устаревшее программное обеспечение не сможет корректно декодировать информацию, закодированную в UTF-16, даже если используются только символы ASCII.
* Все значения Unicode меньшие чем 2^16, могут быть представлены только в одной единице кода (двумя октетами).
* При использовании значений Unicode большем чем 2^16, требуется две единицы кода (четыре октета).
* Не поддерживается многими, основанными на Unix, операционными системами.
* Критичен к последовательности записи байт.
* Возможность полной потери информации при повреждении файла, сбоях в передаче, или некорректном чтении. 


К использованию того или иного формата кодирования нужно подойти с умом, но также необходимо понимать, что формат UTF-8 является более универсальным, чем другие форматы. Даже несмотря на то, что в некоторых случаях размер файлов может быть больше, по сравнению с другими форматами кодирования.

***
*Хамадиев Ришат Расимович, 
richardham@mail.ru, 
+7 (917) 730-36-38, 
+7 (999) 623-78-43.*
